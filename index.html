<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Predio La Cruz - Gesti√≥n Profesional</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Poppins:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --azul-lacruz: #1a2c5b;
            --rojo-lacruz: #e31e24;
            --verde-cesped: #2d5a27;
            --verde-claro: #4a9d2c;
            --blanco: #ffffff;
            --oscuro: #0a0e1a;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--oscuro); color: white; overflow-x: hidden; }

        /* MENU HAMBURGUESA */
        .menu-toggle {
            position: fixed; top: 15px; left: 15px; z-index: 1100;
            background: var(--azul-lacruz); color: white; border: none;
            width: 50px; height: 50px; border-radius: 10px; cursor: pointer; font-size: 1.5rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: 0.3s;
        }
        .menu-toggle:hover { background: var(--rojo-lacruz); }

        .side-menu {
            position: fixed; top: 0; left: -100%; width: 280px; height: 100vh;
            background: var(--azul-lacruz); z-index: 1050; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            padding-top: 80px; border-right: 3px solid var(--rojo-lacruz); overflow-y: auto;
        }
        .side-menu.open { left: 0; }
        .menu-item { 
            padding: 18px 25px; color: white; text-decoration: none; display: block; 
            font-weight: 600; border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer;
            transition: 0.2s;
        }
        .menu-item:hover { background: rgba(255,255,255,0.05); }
        .menu-item:active { background: var(--rojo-lacruz); }

        .overlay { 
            position: fixed; display: none; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.8); z-index: 1040; backdrop-filter: blur(4px); 
        }

        /* PAGINAS */
        .page { display: none; min-height: 100vh; }
        .page.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* PORTADA */
        #page-home { 
            text-align: center; padding: 80px 20px; 
            background: radial-gradient(circle at center, #1a2c5b 0%, #0a0e1a 100%); 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
        }
        .logo-img { 
            width: 220px; margin-bottom: 25px; 
            filter: drop-shadow(0 0 20px rgba(227,30,36,0.3)); 
            animation: pulse 3s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .home-title { font-family: 'Poppins'; font-size: 2.5rem; font-weight: 900; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 2px; }
        .home-desc { color: #8a99b1; max-width: 400px; font-weight: 400; line-height: 1.6; margin-bottom: 40px; font-size: 1.1rem; }

        /* HEADER INTERNO */
        header { 
            background: var(--azul-lacruz); padding: 20px 20px 20px 80px; 
            font-family: 'Poppins'; border-bottom: 3px solid var(--rojo-lacruz); 
            position: sticky; top: 0; z-index: 100; font-size: 1.3rem; font-weight: 800;
        }
        
        /* CONTENEDORES */
        .container { padding: 15px; max-width: 1200px; margin: 0 auto; }
        .card { 
            background: #161c2d; border-radius: 20px; padding: 25px; margin-bottom: 20px; 
            border: 1px solid rgba(255,255,255,0.05); box-shadow: 0 10px 30px rgba(0,0,0,0.3); 
        }
        .card h3 { color: var(--rojo-lacruz); margin-bottom: 15px; font-size: 1.3rem; letter-spacing: 1px; }

        /* CANCHA CARGA */
        .field-main-wrap { 
            max-width: 400px; margin: 0 auto 20px; 
            background: #1e3d1a; border: 5px solid #0f210d; 
            border-radius: 12px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        canvas { width: 100%; display: block; cursor: crosshair; }

        /* ANALISIS - 3 CANCHAS */
        .analysis-row { 
            display: flex; gap: 15px; justify-content: flex-start; 
            overflow-x: auto; padding: 10px 0 20px; scrollbar-width: thin; 
        }
        .mini-field-box { 
            flex: 0 0 340px; background: #0f1420; border-radius: 15px; 
            padding: 15px; text-align: center; border: 1px solid #222; 
        }
        .mini-field-box h4 { 
            margin-bottom: 15px; color: var(--rojo-lacruz); 
            letter-spacing: 1px; font-size: 1.2rem; font-weight: 800;
        }

        /* ESTAD√çSTICAS */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        .stat-box {
            background: linear-gradient(135deg, var(--azul-lacruz), #2d4a7c);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .stat-number {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--rojo-lacruz);
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 0.85rem;
            color: #8a99b1;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* BOTONES Y FORM */
        .btn-action { 
            background: var(--verde-cesped); color: white; border: none; 
            padding: 18px; border-radius: 12px; font-weight: 800; 
            cursor: pointer; width: 100%; text-transform: uppercase; 
            letter-spacing: 1px; transition: 0.2s; font-size: 1rem;
            box-shadow: 0 5px 15px rgba(45,90,39,0.4);
        }
        .btn-action:hover { background: var(--verde-claro); transform: translateY(-2px); }
        .btn-action:active { transform: scale(0.98); }
        
        .btn-rojo {
            background: var(--rojo-lacruz);
            box-shadow: 0 5px 15px rgba(227,30,36,0.4);
        }
        .btn-rojo:hover { background: #ff3333; }

        select, input[type="range"], input[type="number"], input[type="datetime-local"], textarea { 
            width: 100%; padding: 15px; background: #0a0e1a; 
            border: 1px solid #333; border-radius: 10px; color: white; 
            margin-top: 10px; font-family: inherit; font-size: 1rem;
        }
        
        label { 
            display: block; margin-top: 15px; font-weight: 600; 
            color: #8a99b1; font-size: 0.95rem;
        }

        /* FOTOS */
        .photo-upload {
            border: 2px dashed var(--verde-cesped);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background: rgba(45,90,39,0.1);
            margin-top: 10px;
            transition: 0.3s;
        }
        .photo-upload:hover {
            background: rgba(45,90,39,0.2);
            border-color: var(--verde-claro);
        }
        .photo-upload input { display: none; }

        .photo-preview {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .photo-preview img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 10px;
            border: 3px solid var(--verde-cesped);
            cursor: pointer;
            transition: 0.3s;
        }
        .photo-preview img:hover {
            transform: scale(1.1);
            border-color: var(--rojo-lacruz);
        }

        /* TABLA REGISTROS */
        .table-wrap { overflow-x: auto; margin-top: 10px; }
        .tabla-registros { 
            width: 100%; border-collapse: collapse; min-width: 500px; 
        }
        .tabla-registros th { 
            background: #1f2937; padding: 15px; text-align: left; 
            font-size: 0.8rem; text-transform: uppercase; color: #8a99b1; 
            font-weight: 800; letter-spacing: 1px;
        }
        .tabla-registros td { 
            padding: 15px; border-bottom: 1px solid #1f2937; font-size: 0.9rem; 
        }
        .tabla-registros tr:hover {
            background: rgba(255,255,255,0.02);
        }

        .btn-delete {
            background: var(--rojo-lacruz);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
        }
        .btn-delete:hover {
            background: #ff3333;
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.95);
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .modal.show { display: flex; }
        .modal img {
            max-width: 90%;
            max-height: 90%;
            border-radius: 10px;
        }
        .modal-close {
            position: absolute;
            top: 20px;
            right: 40px;
            color: white;
            font-size: 40px;
            cursor: pointer;
            background: var(--rojo-lacruz);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* COORDINADAS DISPLAY */
        .coords-display {
            background: rgba(26,44,91,0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin: 15px 0;
            border: 2px dashed var(--azul-lacruz);
            min-height: 60px;
            font-weight: 600;
            color: var(--rojo-lacruz);
        }
    </style>
</head>
<body>

    <button class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>
    <div class="overlay" id="overlay" onclick="toggleMenu()"></div>

    <nav class="side-menu" id="sideMenu">
        <div class="menu-item" onclick="showPage('home')">üè† INICIO</div>
        <div class="menu-item" onclick="showPage('riego')">üíß CARGA DE RIEGO</div>
        <div class="menu-item" onclick="showPage('tareas')">üîß CARGA DE TAREAS</div>
        <div class="menu-item" onclick="showPage('analisis')">üìä AN√ÅLISIS DE ESTADO</div>
        <div class="menu-item" onclick="showPage('historial')">üìú HISTORIAL COMPLETO</div>
    </nav>

    <!-- PORTADA -->
    <div id="page-home" class="page active">
        <svg class="logo-img" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
            <circle cx="100" cy="100" r="95" fill="#1a2c5b" stroke="#e31e24" stroke-width="5"/>
            <text x="100" y="110" text-anchor="middle" fill="white" font-size="60" font-family="Poppins" font-weight="900">LC</text>
        </svg>
        <h1 class="home-title">PREDIO LA CRUZ</h1>
        <p class="home-desc">Sistema profesional de gesti√≥n, mantenimiento y control integral para canchas de f√∫tbol de c√©sped natural</p>
        <button class="btn-action" style="width:auto; padding: 18px 50px;" onclick="showPage('riego')">EMPEZAR GESTI√ìN</button>
    </div>

    <!-- CARGA DE RIEGO -->
    <div id="page-riego" class="page">
        <header>üíß REGISTRO DE RIEGO</header>
        <div class="container">
            <div class="card">
                <h3>üìç Localizaci√≥n en Cancha (68m √ó 105m)</h3>
                <div class="field-main-wrap">
                    <canvas id="canvasCarga" width="680" height="1050"></canvas>
                </div>
                <div class="coords-display" id="coordsDisplay">
                    Toca sobre la cancha para marcar posici√≥n...
                </div>
                
                <label>Radio de cobertura: <b id="valRad" style="color:var(--rojo-lacruz)">15</b>m</label>
                <input type="range" id="inputRad" min="5" max="30" value="15" oninput="updateRad(this.value)">
                
                <label>Seleccionar Cancha:</label>
                <select id="selCanchaRiego">
                    <option value="1">Cancha 1</option>
                    <option value="2">Cancha 2</option>
                    <option value="3">Cancha 3</option>
                </select>

                <label>Fecha y Hora:</label>
                <input type="datetime-local" id="fechaRiego">

                <label>Duraci√≥n (minutos):</label>
                <input type="number" id="duracionRiego" value="60" min="1">

                <label>Presi√≥n (bar):</label>
                <input type="number" id="presionRiego" value="2.5" step="0.1" min="0">

                <label>Observaciones:</label>
                <textarea id="obsRiego" rows="3" placeholder="Notas adicionales..."></textarea>

                <label>Agregar Fotos:</label>
                <div class="photo-upload" onclick="document.getElementById('fotosRiego').click()">
                    <p>üì∑ Haz clic para agregar fotos</p>
                    <input type="file" id="fotosRiego" accept="image/*" multiple>
                </div>
                <div class="photo-preview" id="previewRiego"></div>

                <button class="btn-action btn-rojo" style="margin-top:25px;" onclick="guardarRiego()">‚úì GUARDAR RIEGO</button>
            </div>
        </div>
    </div>

    <!-- CARGA DE TAREAS -->
    <div id="page-tareas" class="page">
        <header>üîß CARGA DE TAREAS</header>
        <div class="container">
            <div class="card">
                <h3>Tipo de Tarea</h3>
                <select id="tipoTarea" onchange="mostrarFormTarea(this.value)">
                    <option value="">-- Seleccionar --</option>
                    <option value="fertilizacion">üå± Fertilizaci√≥n</option>
                    <option value="slicer">‚úÇÔ∏è Slicer</option>
                    <option value="corte_vertical">üî™ Corte Vertical/Helicoidal</option>
                    <option value="corte_cesped">üåø Corte de C√©sped</option>
                </select>

                <div id="formTarea" style="display:none;">
                    <label>Cancha:</label>
                    <select id="canchaTarea">
                        <option value="1">Cancha 1</option>
                        <option value="2">Cancha 2</option>
                        <option value="3">Cancha 3</option>
                    </select>

                    <label>Fecha y Hora:</label>
                    <input type="datetime-local" id="fechaTarea">

                    <!-- FERTILIZACI√ìN -->
                    <div id="formFertilizacion" style="display:none;">
                        <label>Cantidad de Fertilizante (kg):</label>
                        <input type="number" id="cantFertilizante" min="0" step="0.1" placeholder="Ej: 50">
                        
                        <label>Tipo de Fertilizante:</label>
                        <input type="text" id="tipoFertilizante" placeholder="Ej: NPK 15-15-15">
                    </div>

                    <!-- CORTE VERTICAL -->
                    <div id="formCorteVertical" style="display:none;">
                        <label>Con cepillado:</label>
                        <select id="conCepillado">
                            <option value="si">S√≠</option>
                            <option value="no">No</option>
                        </select>

                        <label>Con recolecci√≥n de material:</label>
                        <select id="conRecoleccion">
                            <option value="si">S√≠</option>
                            <option value="no">No</option>
                        </select>
                    </div>

                    <!-- CORTE DE C√âSPED -->
                    <div id="formCorteCesped" style="display:none;">
                        <label>Altura de corte:</label>
                        <select id="alturaCesped">
                            <option value="1">1 - Muy bajo (15-20mm)</option>
                            <option value="2">2 - Bajo (20-25mm)</option>
                            <option value="3">3 - Medio (25-30mm)</option>
                            <option value="4">4 - Alto (30-35mm)</option>
                        </select>
                    </div>

                    <label>Observaciones:</label>
                    <textarea id="obsTarea" rows="3" placeholder="Notas adicionales..."></textarea>

                    <label>Agregar Fotos:</label>
                    <div class="photo-upload" onclick="document.getElementById('fotosTarea').click()">
                        <p>üì∑ Haz clic para agregar fotos</p>
                        <input type="file" id="fotosTarea" accept="image/*" multiple>
                    </div>
                    <div class="photo-preview" id="previewTarea"></div>

                    <button class="btn-action btn-rojo" style="margin-top:25px;" onclick="guardarTarea()">‚úì GUARDAR TAREA</button>
                </div>
            </div>
        </div>
    </div>

    <!-- AN√ÅLISIS DE ESTADO -->
    <div id="page-analisis" class="page">
        <header>üìä AN√ÅLISIS T√âCNICO</header>
        <div class="container">
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-number" id="statRiegos">0</div>
                    <div class="stat-label">Riegos Totales</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="statTareas">0</div>
                    <div class="stat-label">Tareas Realizadas</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="statCancha1">0</div>
                    <div class="stat-label">Cancha 1</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="statCancha2">0</div>
                    <div class="stat-label">Cancha 2</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="statCancha3">0</div>
                    <div class="stat-label">Cancha 3</div>
                </div>
            </div>

            <div class="card">
                <h3>Vista de Canchas</h3>
                <div class="analysis-row" id="rowAnalisis"></div>
            </div>
        </div>
    </div>

    <!-- HISTORIAL COMPLETO -->
    <div id="page-historial" class="page">
        <header>üìú HISTORIAL COMPLETO</header>
        <div class="container">
            <div class="card">
                <h3>Registros de Riego</h3>
                <div class="table-wrap">
                    <table class="tabla-registros">
                        <thead>
                            <tr>
                                <th>Cancha</th>
                                <th>Fecha</th>
                                <th>Duraci√≥n</th>
                                <th>Presi√≥n</th>
                                <th>Observaciones</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyRiegos"></tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h3>Registros de Tareas</h3>
                <div class="table-wrap">
                    <table class="tabla-registros">
                        <thead>
                            <tr>
                                <th>Tipo</th>
                                <th>Cancha</th>
                                <th>Fecha</th>
                                <th>Detalles</th>
                                <th>Observaciones</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyTareas"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL PARA FOTOS -->
    <div class="modal" id="modal" onclick="closeModal()">
        <span class="modal-close">&times;</span>
        <img id="modalImg" src="" alt="">
    </div>

    <script>
        // DATOS
        let datosRiego = JSON.parse(localStorage.getItem('lacruz_riegos')) || [];
        let datosTareas = JSON.parse(localStorage.getItem('lacruz_tareas')) || [];
        let pActual = null;
        let rActual = 15;
        let fotosRiegoTemp = [];
        let fotosTareaTemp = [];

        // INICIALIZACI√ìN
        window.onload = () => {
            document.getElementById('fechaRiego').value = new Date().toISOString().slice(0, 16);
            document.getElementById('fechaTarea').value = new Date().toISOString().slice(0, 16);
        };

        // MEN√ö
        function toggleMenu() {
            const m = document.getElementById('sideMenu');
            const o = document.getElementById('overlay');
            const open = m.classList.toggle('open');
            o.style.display = open ? 'block' : 'none';
        }

        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + id).classList.add('active');
            toggleMenu();
            
            if(id === 'riego') setTimeout(dibujaCarga, 50);
            if(id === 'analisis') setTimeout(dibujaAnalisis, 50);
            if(id === 'historial') setTimeout(dibujaHistorial, 50);
        }

        // RIEGO
        function updateRad(v) { 
            rActual = v; 
            document.getElementById('valRad').innerText = v; 
            dibujaCarga(); 
        }

        function dibujarLineas(ctx, w, h) {
            ctx.strokeStyle = "rgba(255,255,255,0.7)";
            ctx.lineWidth = 3;
            const m = 15;

            ctx.strokeRect(m, m, w - m*2, h - m*2);
            ctx.beginPath(); ctx.moveTo(m, h/2); ctx.lineTo(w-m, h/2); ctx.stroke();
            ctx.beginPath(); ctx.arc(w/2, h/2, w/6, 0, Math.PI*2); ctx.stroke();
            
            const areaW = w * 0.6; 
            const areaH = h * 0.15;
            ctx.strokeRect((w-areaW)/2, m, areaW, areaH);
            ctx.strokeRect((w-areaW)/2, h-m-areaH, areaW, areaH);
        }

        function dibujaCarga() {
            const cv = document.getElementById('canvasCarga');
            if (!cv) return;
            const ctx = cv.getContext('2d');
            const esc = cv.width / 68;

            ctx.fillStyle = "#2d5a27"; 
            ctx.fillRect(0,0,cv.width, cv.height);
            
            // Sectores 3x2
            ctx.strokeStyle = "rgba(255,255,255,0.1)";
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(cv.width/3, 0); ctx.lineTo(cv.width/3, cv.height);
            ctx.moveTo((cv.width/3)*2, 0); ctx.lineTo((cv.width/3)*2, cv.height);
            ctx.moveTo(0, cv.height/2); ctx.lineTo(cv.width, cv.height/2);
            ctx.stroke();
            ctx.setLineDash([]);

            dibujarLineas(ctx, cv.width, cv.height);

            cv.onclick = (e) => {
                const r = cv.getBoundingClientRect();
                pActual = { 
                    x: (e.clientX - r.left)*(cv.width/r.width), 
                    y: (e.clientY - r.top)*(cv.height/r.height) 
                };
                const fx = (pActual.x / cv.width) * 68;
                const fy = (pActual.y / cv.height) * 105;
                document.getElementById('coordsDisplay').innerHTML = 
                    `üìç Posici√≥n: X=${fx.toFixed(1)}m, Y=${fy.toFixed(1)}m`;
                dibujaCarga();
            };

            if(pActual) {
                ctx.fillStyle = "rgba(227,30,36,0.5)";
                ctx.beginPath(); 
                ctx.arc(pActual.x, pActual.y, rActual*esc, 0, Math.PI*2); 
                ctx.fill();
                
                ctx.fillStyle = "white";
                ctx.shadowColor = "rgba(0,0,0,0.5)";
                ctx.shadowBlur = 10;
                ctx.beginPath(); 
                ctx.arc(pActual.x, pActual.y, 8, 0, Math.PI*2); 
                ctx.fill();
                ctx.shadowBlur = 0;
            }
        }

        // FOTOS RIEGO
        document.getElementById('fotosRiego').addEventListener('change', (e) => {
            const preview = document.getElementById('previewRiego');
            Array.from(e.target.files).forEach(file => {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    fotosRiegoTemp.push(ev.target.result);
                    const img = document.createElement('img');
                    img.src = ev.target.result;
                    img.onclick = () => openModal(ev.target.result);
                    preview.appendChild(img);
                };
                reader.readAsDataURL(file);
            });
        });

        function guardarRiego() {
            if(!pActual) {
                alert("‚ö†Ô∏è Marca un punto en la cancha primero");
                return;
            }

            const registro = {
                id: Date.now(),
                tipo: 'riego',
                cancha: document.getElementById('selCanchaRiego').value,
                x: pActual.x,
                y: pActual.y,
                radio: rActual,
                fecha: document.getElementById('fechaRiego').value,
                duracion: document.getElementById('duracionRiego').value,
                presion: document.getElementById('presionRiego').value,
                obs: document.getElementById('obsRiego').value,
                fotos: [...fotosRiegoTemp]
            };

            datosRiego.push(registro);
            localStorage.setItem('lacruz_riegos', JSON.stringify(datosRiego));
            
            alert("‚úÖ Riego guardado exitosamente");
            
            // Limpiar
            pActual = null;
            fotosRiegoTemp = [];
            document.getElementById('previewRiego').innerHTML = '';
            document.getElementById('obsRiego').value = '';
            document.getElementById('coordsDisplay').innerHTML = 'Toca sobre la cancha para marcar posici√≥n...';
            dibujaCarga();
        }

        // TAREAS
        function mostrarFormTarea(tipo) {
            document.getElementById('formTarea').style.display = tipo ? 'block' : 'none';
            document.getElementById('formFertilizacion').style.display = 'none';
            document.getElementById('formCorteVertical').style.display = 'none';
            document.getElementById('formCorteCesped').style.display = 'none';

            if(tipo === 'fertilizacion') document.getElementById('formFertilizacion').style.display = 'block';
            if(tipo === 'corte_vertical') document.getElementById('formCorteVertical').style.display = 'block';
            if(tipo === 'corte_cesped') document.getElementById('formCorteCesped').style.display = 'block';
        }

        // FOTOS TAREAS
        document.getElementById('fotosTarea').addEventListener('change', (e) => {
            const preview = document.getElementById('previewTarea');
            Array.from(e.target.files).forEach(file => {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    fotosTareaTemp.push(ev.target.result);
                    const img = document.createElement('img');
                    img.src = ev.target.result;
                    img.onclick = () => openModal(ev.target.result);
                    preview.appendChild(img);
                };
                reader.readAsDataURL(file);
            });
        });

        function guardarTarea() {
            const tipo = document.getElementById('tipoTarea').value;
            if(!tipo) {
                alert("‚ö†Ô∏è Selecciona un tipo de tarea");
                return;
            }

            const registro = {
                id: Date.now(),
                tipo: tipo,
                cancha: document.getElementById('canchaTarea').value,
                fecha: document.getElementById('fechaTarea').value,
                obs: document.getElementById('obsTarea').value,
                fotos: [...fotosTareaTemp],
                detalles: {}
            };

            // Detalles espec√≠ficos
            if(tipo === 'fertilizacion') {
                registro.detalles = {
                    cantidad: document.getElementById('cantFertilizante').value,
                    tipoFert: document.getElementById('tipoFertilizante').value
                };
            } else if(tipo === 'corte_vertical') {
                registro.detalles = {
                    cepillado: document.getElementById('conCepillado').value,
                    recoleccion: document.getElementById('conRecoleccion').value
                };
            } else if(tipo === 'corte_cesped') {
                registro.detalles = {
                    altura: document.getElementById('alturaCesped').value
                };
            }

            datosTareas.push(registro);
            localStorage.setItem('lacruz_tareas', JSON.stringify(datosTareas));
            
            alert("‚úÖ Tarea guardada exitosamente");
            
            // Limpiar
            fotosTareaTemp = [];
            document.getElementById('previewTarea').innerHTML = '';
            document.getElementById('obsTarea').value = '';
            document.getElementById('formTarea').style.display = 'none';
            document.getElementById('tipoTarea').value = '';
        }

        // AN√ÅLISIS
        function dibujaAnalisis() {
            const container = document.getElementById('rowAnalisis');
            container.innerHTML = '';

            // Estad√≠sticas
            document.getElementById('statRiegos').textContent = datosRiego.length;
            document.getElementById('statTareas').textContent = datosTareas.length;
            document.getElementById('statCancha1').textContent = datosRiego.filter(d => d.cancha == 1).length;
            document.getElementById('statCancha2').textContent = datosRiego.filter(d => d.cancha == 2).length;
            document.getElementById('statCancha3').textContent = datosRiego.filter(d => d.cancha == 3).length;

            [1, 2, 3].forEach(num => {
                const box = document.createElement('div');
                box.className = 'mini-field-box';
                box.innerHTML = `<h4>CANCHA ${num}</h4><canvas id="mini${num}" width="340" height="525"></canvas>`;
                container.appendChild(box);
                
                setTimeout(() => {
                    const cv = document.getElementById(`mini${num}`);
                    if(!cv) return;
                    const ctx = cv.getContext('2d');
                    const canchadata = datosRiego.filter(d => d.cancha == num);

                    ctx.fillStyle = "#1e3d1a"; 
                    ctx.fillRect(0,0,cv.width, cv.height);
                    
                    // Sectores
                    ctx.strokeStyle = "rgba(255,255,255,0.05)";
                    ctx.setLineDash([3, 3]);
                    ctx.beginPath();
                    ctx.moveTo(cv.width/3, 0); ctx.lineTo(cv.width/3, cv.height);
                    ctx.moveTo((cv.width/3)*2, 0); ctx.lineTo((cv.width/3)*2, cv.height);
                    ctx.moveTo(0, cv.height/2); ctx.lineTo(cv.width, cv.height/2);
                    ctx.stroke();
                    ctx.setLineDash([]);

                    canchadata.forEach(d => {
                        const esc = cv.width / 680;
                        const grd = ctx.createRadialGradient(
                            d.x*esc, d.y*esc, 0, 
                            d.x*esc, d.y*esc, d.radio*(cv.width/68)
                        );
                        grd.addColorStop(0, "rgba(76, 175, 80, 0.8)");
                        grd.addColorStop(1, "transparent");
                        ctx.fillStyle = grd;
                        ctx.beginPath(); 
                        ctx.arc(d.x*esc, d.y*esc, d.radio*(cv.width/68), 0, Math.PI*2); 
                        ctx.fill();
                    });

                    dibujarLineas(ctx, cv.width, cv.height);
                }, 10);
            });
        }

        // HISTORIAL
        function dibujaHistorial() {
            const tbodyRiegos = document.getElementById('tbodyRiegos');
            const tbodyTareas = document.getElementById('tbodyTareas');

            tbodyRiegos.innerHTML = '';
            tbodyTareas.innerHTML = '';

            // Riegos
            datosRiego.slice().reverse().forEach(r => {
                tbodyRiegos.innerHTML += `
                    <tr>
                        <td>Cancha ${r.cancha}</td>
                        <td>${new Date(r.fecha).toLocaleString()}</td>
                        <td>${r.duracion} min</td>
                        <td>${r.presion} bar</td>
                        <td>${r.obs || '-'}</td>
                        <td><button class="btn-delete" onclick="eliminarRiego(${r.id})">üóëÔ∏è</button></td>
                    </tr>
                `;
            });

            // Tareas
            datosTareas.slice().reverse().forEach(t => {
                let detallesHTML = '';
                if(t.tipo === 'fertilizacion') {
                    detallesHTML = `${t.detalles.cantidad}kg ${t.detalles.tipoFert}`;
                } else if(t.tipo === 'corte_vertical') {
                    detallesHTML = `Cepillado: ${t.detalles.cepillado}, Recolecci√≥n: ${t.detalles.recoleccion}`;
                } else if(t.tipo === 'corte_cesped') {
                    detallesHTML = `Altura: ${t.detalles.altura}`;
                } else if(t.tipo === 'slicer') {
                    detallesHTML = 'Slicer aplicado';
                }

                const tipoNombre = {
                    'fertilizacion': 'üå± Fertilizaci√≥n',
                    'slicer': '‚úÇÔ∏è Slicer',
                    'corte_vertical': 'üî™ Corte Vertical',
                    'corte_cesped': 'üåø Corte C√©sped'
                };

                tbodyTareas.innerHTML += `
                    <tr>
                        <td>${tipoNombre[t.tipo] || t.tipo}</td>
                        <td>Cancha ${t.cancha}</td>
                        <td>${new Date(t.fecha).toLocaleString()}</td>
                        <td>${detallesHTML}</td>
                        <td>${t.obs || '-'}</td>
                        <td><button class="btn-delete" onclick="eliminarTarea(${t.id})">üóëÔ∏è</button></td>
                    </tr>
                `;
            });
        }

        function eliminarRiego(id) {
            if(!confirm('¬øEliminar este registro de riego?')) return;
            datosRiego = datosRiego.filter(r => r.id !== id);
            localStorage.setItem('lacruz_riegos', JSON.stringify(datosRiego));
            dibujaHistorial();
            alert('‚úÖ Registro eliminado');
        }

        function eliminarTarea(id) {
            if(!confirm('¬øEliminar esta tarea?')) return;
            datosTareas = datosTareas.filter(t => t.id !== id);
            localStorage.setItem('lacruz_tareas', JSON.stringify(datosTareas));
            dibujaHistorial();
            alert('‚úÖ Tarea eliminada');
        }

        // MODAL
        function openModal(src) {
            document.getElementById('modalImg').src = src;
            document.getElementById('modal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('show');
        }
    </script>
</body>
</html>
